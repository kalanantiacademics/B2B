<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-Test Python Fundamentals (SMK)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --color-yellow: #FDB913;
            --color-green: #00A651;
            --color-blue: #0054A6;
            --color-cream: #FFF8E7;
            --color-black: #231F20;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-cream);
            color: var(--color-black);
        }

        h1,
        h2,
        h3 {
            font-family: 'Playfair Display', serif;
        }

        .bg-geo {
            background-image: radial-gradient(circle at 10% 10%, var(--color-yellow) 10%, transparent 10.5%), radial-gradient(circle at 90% 90%, var(--color-green) 15%, transparent 15.5%);
            background-attachment: fixed;
        }

        .neo-card {
            background: white;
            border: 3px solid black;
            box-shadow: 6px 6px 0px black;
        }

        .neo-input {
            border: 2px solid black;
            outline: none;
            transition: 0.2s;
        }

        .neo-input:focus {
            background-color: #FEF3C7;
            box-shadow: 4px 4px 0px black;
            transform: translate(-2px, -2px);
        }

        .neo-btn {
            background-color: var(--color-blue);
            color: white;
            border: 2px solid black;
            font-weight: bold;
            box-shadow: 4px 4px 0px black;
            transition: 0.2s;
        }

        .neo-btn:hover:not(:disabled) {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px black;
        }

        .neo-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        .neo-radio:checked+span {
            background-color: var(--color-yellow);
            font-weight: bold;
            border: 2px solid black;
            box-shadow: 4px 4px 0px black;
            transform: translate(-2px, -2px);
        }

        .error-box {
            background-color: #FEE2E2;
            border: 2px solid #EF4444;
            color: #B91C1C;
            padding: 1rem;
            font-weight: bold;
            font-size: 0.9rem;
            word-break: break-word;
        }

        /* Style khusus untuk blok kode */
        .code-block {
            background-color: #1F2937;
            /* Gray-800 */
            color: #F3F4F6;
            /* Gray-100 */
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            border: 2px solid black;
            box-shadow: 4px 4px 0px black;
            overflow-x: auto;
        }
    </style>
</head>

<body class="bg-geo min-h-screen p-4 flex flex-col items-center justify-center">

    <!-- Logos -->
    <div class="fixed top-5 left-5 z-50 flex gap-4">
        <img src="https://cdn-web-2.ruangguru.com/landing-pages/assets/e7d93748-818d-462d-be57-7db1e479cd62.png"
            class="h-10 md:h-12">
    </div>

    <!-- MAIN CARD -->
    <div class="neo-card w-full max-w-3xl p-0 overflow-hidden mt-12 mb-10 relative">
        <div class="bg-blue-600 p-6 text-white border-b-2 border-black">
            <h1 class="text-3xl md:text-4xl font-bold">Post-Test: Python (SMK)</h1>
            <p class="mt-2 text-sm md:text-lg opacity-90 italic font-serif">"Kerjakan dengan jujur."</p>
        </div>

        <div class="p-6 md:p-8">
            <!-- SECTION 1: LOGIN -->
            <div id="section-login" class="space-y-6">
                <h2 class="text-2xl font-bold border-b-2 border-black pb-2 inline-block">Identitas Diri</h2>

                <div class="bg-gray-50 p-6 border-2 border-black">
                    <label class="block text-lg font-bold mb-2">Pilih Nama Kamu</label>

                    <div id="loading-indicator" class="text-gray-500 animate-pulse flex items-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-blue-600" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Mencari data siswa SMK...
                    </div>

                    <div id="error-display" class="hidden error-box mb-2"></div>

                    <select id="select-nama" class="w-full p-3 neo-input bg-white hidden">
                        <option value="" disabled selected>-- Pilih Nama --</option>
                    </select>
                </div>

                <div class="flex gap-2">
                    <button onclick="fetchParticipants()" id="btn-retry"
                        class="hidden w-1/3 neo-btn py-3 bg-gray-500 hover:bg-gray-600">Coba Lagi</button>
                    <button onclick="startQuiz()" id="btn-start" class="w-full neo-btn py-3 text-xl" disabled>MULAI
                        UJIAN</button>
                </div>
            </div>

            <!-- SECTION 2: QUIZ -->
            <form id="quizForm" class="hidden space-y-8">
                <div
                    class="bg-yellow-100 p-4 border-2 border-black flex justify-between items-center sticky top-0 z-10 shadow-md">
                    <div>
                        <span class="text-xs font-bold uppercase tracking-wider text-gray-600">Peserta:</span>
                        <div id="display-nama" class="text-lg font-bold truncate">...</div>
                    </div>
                    <button type="button" onclick="resetIdentity()"
                        class="text-xs text-red-600 underline hover:text-red-800">Ganti Nama</button>
                </div>

                <div id="questions-container" class="space-y-8 mt-4">
                    <!-- Q1 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">1. Perintah menampilkan teks ke layar di Python?</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q1" value="echo" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">echo("Hello")</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q1" value="print"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">print("Hello")</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q1"
                                    value="console.log" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">console.log("Hello")</span></label>
                        </div>
                    </div>

                    <!-- Q2 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">2. Cara membuat variabel yang BENAR?</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q2" value="var x = 5" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">var x =
                                    5</span></label><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q2" value="x = 5" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">x =
                                    5</span></label><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q2" value="int x = 5" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">int x =
                                    5</span></label></div>
                    </div>

                    <!-- Q3 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">3. Tipe data untuk teks seperti "Kalananti"?</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q3" value="Integer" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Integer</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q3" value="String"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">String</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q3" value="Boolean"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Boolean</span></label>
                        </div>
                    </div>

                    <!-- Q4 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">4. Fungsi input() selalu menghasilkan tipe data...</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q4" value="String" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">String
                                    (Teks)</span></label><label class="flex items-center cursor-pointer"><input
                                    type="radio" name="q4" value="Integer" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Integer
                                    (Angka)</span></label><label class="flex items-center cursor-pointer"><input
                                    type="radio" name="q4" value="List" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">List
                                    (Daftar)</span></label></div>
                    </div>

                    <!-- Q5 (UPDATED: Console Style) -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-2">5. Apa output dari kode ini?</p>
                        <pre class="code-block">
if 10 > 5:
    print("Benar")
else:
    print("Salah")</pre>
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q5" value="Benar"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Benar</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q5" value="Salah"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Salah</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q5" value="Error"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Error</span></label>
                        </div>
                    </div>

                    <!-- Q6 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">6. range(5) menghasilkan angka?</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q6" value="1, 2, 3, 4, 5" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">1, 2, 3,
                                    4, 5</span></label><label class="flex items-center cursor-pointer"><input
                                    type="radio" name="q6" value="0, 1, 2, 3, 4" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">0, 1, 2,
                                    3, 4</span></label><label class="flex items-center cursor-pointer"><input
                                    type="radio" name="q6" value="0, 1, 2, 3, 4, 5" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">0, 1, 2,
                                    3, 4, 5</span></label></div>
                    </div>

                    <!-- Q7 (UPDATED: Console Style) -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-2">7. Jika kita punya list buah seperti ini:</p>
                        <pre class="code-block">
buah = ["Apel", "Mangga", "Jeruk"]</pre>
                        <p class="font-bold text-lg mb-3">Bagaimana cara mengambil "Mangga"?</p>
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q7"
                                    value="buah[0]" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">buah[0]</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q7"
                                    value="buah[1]" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">buah[1]</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q7"
                                    value="buah[2]" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">buah[2]</span></label>
                        </div>
                    </div>

                    <!-- Q8 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">8. Struktur data Key dan Value (seperti kamus) disebut...</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q8" value="List" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">List</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q8"
                                    value="Dictionary" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Dictionary</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q8" value="Tuple"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Tuple</span></label>
                        </div>
                    </div>

                    <!-- Q9 -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-3">9. Nilai True dan False adalah tipe data?</p>
                        <div class="space-y-2"><label class="flex items-center cursor-pointer"><input type="radio"
                                    name="q9" value="String" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">String</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q9" value="Boolean"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Boolean</span></label><label
                                class="flex items-center cursor-pointer"><input type="radio" name="q9" value="Float"
                                    class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">Float</span></label>
                        </div>
                    </div>

                    <!-- Q10 (UPDATED: Console Style) -->
                    <div class="question-box">
                        <p class="font-bold text-lg mb-2">10. Berapa kali "Halo" akan dicetak?</p>
                        <pre class="code-block">
for i in range(3):
    print("Halo")</pre>
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q10"
                                    value="2 kali" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">2
                                    kali</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q10"
                                    value="3 kali" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">3
                                    kali</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="q10"
                                    value="4 kali" class="neo-radio hidden"><span
                                    class="w-full p-3 border-2 border-gray-200 rounded block hover:bg-gray-50">4
                                    kali</span></label>
                        </div>
                    </div>
                </div>

                <button type="submit" id="btn-submit" class="w-full neo-btn py-4 text-xl">KIRIM JAWABAN</button>
            </form>

            <!-- SECTION 3: SUCCESS -->
            <div id="section-success" class="hidden text-center py-10">
                <div class="text-8xl mb-4">ðŸŽ‰</div>
                <h2 class="text-3xl font-bold mb-2">Jawaban Terkirim!</h2>
                <p class="text-gray-600 mb-8" id="success-name-display">Terima kasih.</p>
                <button onclick="location.reload()" class="text-blue-600 underline">Reload Halaman</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMHEKDQnBOOeyLq0ow8-cc7erEf-ctBJSFaSAnzkWSCtaOv8cmeRhILBXmly3-5IkinQ/exec';

        // Answer Keys for Client-Side Grading
        const ANSWERS = {
            q1: 'print',
            q2: 'x = 5',
            q3: 'String',
            q4: 'String',
            q5: 'Benar',
            q6: '0, 1, 2, 3, 4',
            q7: 'buah[1]',
            q8: 'Dictionary',
            q9: 'Boolean',
            q10: '3 kali'
        };

        document.addEventListener('DOMContentLoaded', function () {
            const savedName = localStorage.getItem('post_smk_user_name');
            if (savedName) showQuiz(savedName);
            else fetchParticipants();
            restoreAnswers();
        });

        function fetchParticipants() {
            const loading = document.getElementById('loading-indicator');
            const errorBox = document.getElementById('error-display');
            const select = document.getElementById('select-nama');
            const retryBtn = document.getElementById('btn-retry');

            loading.classList.remove('hidden');
            errorBox.classList.add('hidden');
            select.classList.add('hidden');
            retryBtn.classList.add('hidden');

            console.log("Fetching participants from:", SCRIPT_URL);

            fetch(SCRIPT_URL + '?action=getSmkParticipants')
                .then(response => response.json())
                .then(response => {
                    console.log("Response:", response);
                    if (response.status === 'success') {
                        populateSelect(response.data);
                    } else {
                        throw new Error(response.message || "Gagal memuat data");
                    }
                })
                .catch(error => {
                    console.error('Error fetching participants:', error);
                    loading.classList.add('hidden');
                    errorBox.innerText = 'Gagal memuat data. ' + error.message;
                    errorBox.classList.remove('hidden');
                    retryBtn.classList.remove('hidden');
                });
        }

        function populateSelect(names) {
            const select = document.getElementById('select-nama');
            const loading = document.getElementById('loading-indicator');
            const retryBtn = document.getElementById('btn-retry');

            loading.classList.add('hidden');
            select.innerHTML = '<option value="" disabled selected>-- Pilih Nama --</option>';

            if (!names || names.length === 0) {
                loading.classList.add('hidden');
                document.getElementById('error-display').innerText = 'Data siswa SMK tidak ditemukan.';
                document.getElementById('error-display').classList.remove('hidden');
                return;
            }

            names.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.innerText = name;
                select.appendChild(option);
            });

            select.classList.remove('hidden');
            select.addEventListener('change', function () {
                if (this.value) document.getElementById('btn-start').disabled = false;
            });
        }

        function startQuiz() {
            const name = document.getElementById('select-nama').value;
            if (!name) return;
            localStorage.setItem('post_smk_user_name', name);
            showQuiz(name);
        }

        function showQuiz(name) {
            document.getElementById('section-login').classList.add('hidden');
            document.getElementById('quizForm').classList.remove('hidden');
            document.getElementById('display-nama').innerText = name;
        }

        function resetIdentity() {
            if (confirm('Ganti nama?')) { localStorage.removeItem('post_smk_user_name'); location.reload(); }
        }

        document.getElementById('quizForm').addEventListener('change', function (e) {
            if (e.target.type === 'radio') localStorage.setItem('post_ans_' + e.target.name, e.target.value);
        });

        function restoreAnswers() {
            for (let i = 1; i <= 10; i++) {
                const val = localStorage.getItem('post_ans_q' + i);
                if (val) { const r = document.querySelector(`input[name="q${i}"][value="${val}"]`); if (r) r.checked = true; }
            }
        }

        // Handle Form Submit
        document.getElementById('quizForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const btn = document.getElementById('btn-submit');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "MENGIRIM...";

            const data = {};
            data.nama_peserta = localStorage.getItem('post_smk_user_name');
            data.action = 'submitQuizSmk';

            let score = 0;
            let answeredCount = 0;

            for (let i = 1; i <= 10; i++) {
                const checked = document.querySelector(`input[name="q${i}"]:checked`);
                const answer = checked ? checked.value : '';
                data['q' + i] = answer;

                if (answer) answeredCount++;

                // Grading
                if (answer === ANSWERS['q' + i]) {
                    score += 10;
                }
            }

            data.score = score;
            console.log("Submitting Data:", data);

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(response => {
                    if (response.status === 'success') {
                        localStorage.removeItem('post_smk_user_name');
                        for (let i = 1; i <= 10; i++) localStorage.removeItem('post_ans_q' + i);

                        document.getElementById('quizForm').classList.add('hidden');
                        document.getElementById('section-success').classList.remove('hidden');
                        document.getElementById('success-name-display').innerText = "Terima kasih, " + data.nama_peserta;
                    } else {
                        throw new Error(response.message || 'Unknown error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan saat mengirim: ' + error.message);
                    btn.disabled = false;
                    btn.innerText = originalText;
                });
        });
    </script>

</body>

</html>
